<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bridge CRM - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&display=swap" rel="stylesheet" />
    <style>
        * {
            padding: 0;
            margin: 0;
            border: 0;
            box-sizing: border-box;
        }

        html,
        body {
            min-height: 100%;
            width: 100%;
            font-family: "Play", sans-serif;
            background: #f5f5f5;
            color: #000;
            scroll-behavior: smooth;
        }

        .header {
            background: linear-gradient(135deg, #0095ff 0%, #0077cc 100%);
            color: #fff;
            padding: 30px 0;
            box-shadow: 0 4px 20px rgba(0, 149, 255, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header h1 {
            font-size: clamp(28px, calc(28px + 12 * ((100vw - 375px) / (1230 - 375))), 40px);
            font-weight: 700;
            margin-bottom: 10px;
            color: #fff;
        }

        .header p {
            font-size: clamp(14px, calc(14px + 2 * ((100vw - 375px) / (1230 - 375))), 16px);
            opacity: 0.9;
            color: #fff;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page {
            background: #fff;
            border-radius: 16px;
            padding: 50px;
            margin-bottom: 50px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            min-height: 80vh;
        }

        .page-title {
            font-size: clamp(32px, calc(32px + 10 * ((100vw - 375px) / (1230 - 375))), 42px);
            font-weight: 700;
            color: #0095ff;
            margin-bottom: 40px;
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 4px solid #0095ff;
        }

        .section-title {
            font-size: clamp(24px, calc(24px + 8 * ((100vw - 375px) / (1230 - 375))), 32px);
            font-weight: 700;
            color: #0095ff;
            margin: 40px 0 25px 0;
            padding-bottom: 15px;
            border-bottom: 3px solid #0095ff;
        }

        /* –ë–ª–æ–∫-—Å—Ö–µ–º—ã */
        .diagram-container {
            background: #f9f9f9;
            border-radius: 12px;
            padding: 40px;
            margin: 30px 0;
            overflow-x: auto;
            position: relative;
        }

        .entity-box {
            background: #fff;
            border: 3px solid #0095ff;
            border-radius: 12px;
            padding: 20px;
            margin: 15px;
            display: inline-block;
            min-width: 200px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 149, 255, 0.2);
            transition: all 0.3s ease;
        }

        .entity-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 149, 255, 0.3);
        }

        .entity-box.core {
            background: linear-gradient(135deg, #0095ff 0%, #0077cc 100%);
            color: #fff;
            border-color: #0077cc;
        }

        .entity-box.core h3 {
            color: #fff;
        }

        .entity-box h3 {
            font-size: 20px;
            font-weight: 700;
            color: #0095ff;
            margin-bottom: 10px;
        }

        .entity-box p {
            font-size: 14px;
            color: #666;
            margin: 5px 0;
        }

        .entity-box.core p {
            color: rgba(255, 255, 255, 0.9);
        }

        .entity-box .fields {
            font-size: 12px;
            color: #888;
            margin-top: 10px;
            text-align: left;
        }

        .entity-box.core .fields {
            color: rgba(255, 255, 255, 0.8);
        }

        /* –°–≤—è–∑–∏ */
        .connection {
            position: relative;
            margin: 20px 0;
        }

        .connection-line {
            stroke: #0095ff;
            stroke-width: 3;
            fill: none;
            marker-end: url(#arrowhead);
        }

        .connection-label {
            font-size: 12px;
            fill: #0095ff;
            font-weight: 600;
            background: #fff;
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö */
        .flow-diagram {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 40px 0;
            padding: 30px;
            background: #f9f9f9;
            border-radius: 12px;
        }

        .flow-step {
            background: #fff;
            border: 3px solid #0095ff;
            border-radius: 12px;
            padding: 25px;
            min-width: 200px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 149, 255, 0.2);
        }

        .flow-step::before {
            content: counter(flow-counter);
            counter-increment: flow-counter;
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            background: #0095ff;
            color: #fff;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 4px 10px rgba(0, 149, 255, 0.3);
        }

        .flow-container {
            counter-reset: flow-counter;
        }

        .flow-arrow {
            font-size: 32px;
            color: #0095ff;
            font-weight: bold;
        }

        /* –°—Ç–∞—Ç—É—Å—ã */
        .status-diagram {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: flex-start;
            gap: 30px;
            margin: 40px 0;
            padding: 30px;
            background: #f9f9f9;
            border-radius: 12px;
        }

        .status-column {
            flex: 1;
            min-width: 250px;
            background: #fff;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .status-column.financial {
            border-top: 5px solid #28a745;
        }

        .status-column.cargo {
            border-top: 5px solid #ffc107;
        }

        .status-column.document {
            border-top: 5px solid #dc3545;
        }

        .status-column h4 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }

        .status-column.financial h4 {
            color: #28a745;
        }

        .status-column.cargo h4 {
            color: #ffc107;
        }

        .status-column.document h4 {
            color: #dc3545;
        }

        .status-item {
            background: #f8f9fa;
            border-left: 4px solid #0095ff;
            border-radius: 6px;
            padding: 12px;
            margin: 10px 0;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .status-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0, 149, 255, 0.2);
        }

        .status-item.active {
            background: #e7f3ff;
            border-left-color: #0095ff;
            font-weight: 600;
        }

        /* –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π */
        .app-interaction {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }

        .app-card {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .app-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 149, 255, 0.2);
            border-color: #0095ff;
        }

        .app-card h4 {
            font-size: 20px;
            font-weight: 700;
            color: #0095ff;
            margin-bottom: 15px;
        }

        .app-card ul {
            list-style: none;
            padding: 0;
        }

        .app-card ul li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            font-size: 14px;
            color: #555;
        }

        .app-card ul li::before {
            content: "‚ñ∏";
            position: absolute;
            left: 0;
            color: #0095ff;
            font-weight: bold;
        }

        /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ Deal */
        .deal-center-diagram {
            position: relative;
            min-height: 600px;
            background: #f9f9f9;
            border-radius: 12px;
            padding: 50px;
            margin: 40px 0;
        }

        .deal-center-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #0095ff 0%, #0077cc 100%);
            color: #fff;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 149, 255, 0.4);
            z-index: 10;
            min-width: 300px;
        }

        .deal-center-box h3 {
            font-size: 32px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 15px;
        }

        .deal-center-box p {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.95);
        }

        .connected-entity {
            position: absolute;
            background: #fff;
            border: 3px solid #0095ff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 149, 255, 0.2);
            min-width: 200px;
            text-align: center;
        }

        .connected-entity h4 {
            font-size: 18px;
            font-weight: 700;
            color: #0095ff;
            margin-bottom: 10px;
        }

        .connected-entity.top {
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
        }

        .connected-entity.bottom {
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
        }

        .connected-entity.left {
            left: 50px;
            top: 50%;
            transform: translateY(-50%);
        }

        .connected-entity.right {
            right: 50px;
            top: 50%;
            transform: translateY(-50%);
        }

        .connection-line-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª */
        .lifecycle-diagram {
            position: relative;
            padding: 50px;
            background: #f9f9f9;
            border-radius: 12px;
            margin: 40px 0;
            min-height: 800px;
        }

        .lifecycle-step {
            position: absolute;
            background: #fff;
            border: 3px solid #0095ff;
            border-radius: 12px;
            padding: 20px;
            min-width: 250px;
            box-shadow: 0 4px 15px rgba(0, 149, 255, 0.2);
        }

        .lifecycle-step h4 {
            font-size: 18px;
            font-weight: 700;
            color: #0095ff;
            margin-bottom: 10px;
        }

        .lifecycle-step p {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        /* –õ–µ–≥–µ–Ω–¥–∞ */
        .legend {
            background: #fff;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 2px solid #333;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #d63384;
        }

        @media (max-width: 768px) {
            .page {
                padding: 20px;
            }

            .flow-diagram {
                flex-direction: column;
            }

            .flow-arrow {
                transform: rotate(90deg);
            }

            .status-diagram {
                flex-direction: column;
            }

            .deal-center-diagram {
                min-height: 400px;
                padding: 20px;
            }

            .connected-entity {
                position: relative;
                margin: 10px;
                transform: none !important;
            }
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="header-content">
            <h1>üèóÔ∏è Bridge CRM - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã</h1>
            <p>–í–∏–∑—É–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –±–ª–æ–∫-—Å—Ö–µ–º–∞–º–∏ –∏ –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏ —Å–≤—è–∑–µ–π</p>
        </div>
    </div>

    <div class="container">
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å Deal -->
        <div class="page">
            <h2 class="page-title">üéØ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å: Deal</h2>
            
            <div class="deal-center-diagram">
                <svg class="connection-line-svg">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#0095ff" />
                        </marker>
                    </defs>
                    <!-- –°–≤—è–∑–∏ –±—É–¥—É—Ç –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ SVG -->
                    <line x1="50%" y1="50%" x2="50%" y2="10%" class="connection-line" />
                    <line x1="50%" y1="50%" x2="10%" y2="50%" class="connection-line" />
                    <line x1="50%" y1="50%" x2="90%" y2="50%" class="connection-line" />
                    <line x1="50%" y1="50%" x2="50%" y2="90%" class="connection-line" />
                </svg>

                <div class="deal-center-box">
                    <h3>Deal</h3>
                    <p>–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å —Å–∏—Å—Ç–µ–º—ã</p>
                    <p style="margin-top: 15px; font-size: 14px;">–û–¥–∏–Ω –ª–æ—Ç = –æ–¥–Ω–∞ —Å–¥–µ–ª–∫–∞</p>
                    <div style="margin-top: 20px; font-size: 12px; text-align: left;">
                        <strong>–ü–æ–ª—è:</strong><br>
                        ‚Ä¢ announce_lot (FK)<br>
                        ‚Ä¢ customer (FK)<br>
                        ‚Ä¢ supplier (FK)<br>
                        ‚Ä¢ financial_status<br>
                        ‚Ä¢ cargo_status<br>
                        ‚Ä¢ document_status
                    </div>
                </div>

                <div class="connected-entity top">
                    <h4>AnnounceLot</h4>
                    <p>–õ–æ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è</p>
                    <p style="font-size: 12px; color: #888; margin-top: 10px;">–û–¥–∏–Ω –ª–æ—Ç ‚Üí –æ–¥–Ω–∞ —Å–¥–µ–ª–∫–∞ (constraint)</p>
                </div>

                <div class="connected-entity left">
                    <h4>Customer</h4>
                    <p>–ó–∞–∫–∞–∑—á–∏–∫</p>
                    <p style="font-size: 12px; color: #888; margin-top: 10px;">UserProfile</p>
                </div>

                <div class="connected-entity right">
                    <h4>Supplier</h4>
                    <p>–ü–æ—Å—Ç–∞–≤—â–∏–∫</p>
                    <p style="font-size: 12px; color: #888; margin-top: 10px;">UserProfile</p>
                </div>

                <div class="connected-entity bottom">
                    <h4>DealStatusHistory</h4>
                    <p>–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</p>
                    <p style="font-size: 12px; color: #888; margin-top: 10px;">–ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ - –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–∫—Ç</p>
                </div>
            </div>

            <div class="section-title">–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞:</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <div style="background: #f0f8ff; padding: 20px; border-radius: 8px; border-left: 4px solid #0095ff;">
                    <h4 style="color: #0095ff; margin-bottom: 10px;">–û–¥–∏–Ω –ª–æ—Ç = –æ–¥–Ω–∞ —Å–¥–µ–ª–∫–∞</h4>
                    <p style="font-size: 14px; color: #555;">Constraint <code>unique_deal_per_lot</code> –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å</p>
                </div>
                <div style="background: #f0fff4; padding: 20px; border-radius: 8px; border-left: 4px solid #28a745;">
                    <h4 style="color: #28a745; margin-bottom: 10px;">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤</h4>
                    <p style="font-size: 14px; color: #555;"><code>can_proceed_cargo()</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å</p>
                </div>
                <div style="background: #fff5f5; padding: 20px; border-radius: 8px; border-left: 4px solid #dc3545;">
                    <h4 style="color: #dc3545; margin-bottom: 10px;">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</h4>
                    <p style="font-size: 14px; color: #555;">–ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ DealStatusHistory</p>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2: –ü–æ—Ç–æ–∫ —Å—Ç–∞—Ç—É—Å–æ–≤ -->
        <div class="page">
            <h2 class="page-title">üîÑ –ü–æ—Ç–æ–∫ —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–¥–µ–ª–∫–∏</h2>
            
            <div class="status-diagram">
                <div class="status-column financial">
                    <h4>üí∞ Financial Status</h4>
                    <div class="status-item">0. –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã</div>
                    <div class="status-item">1. –û–ø–ª–∞—Ç–∞ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∞</div>
                    <div class="status-item active">2. –û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ ‚≠ê</div>
                    <div class="status-item">3. –ü–æ—Å—Ç–∞–≤—â–∏–∫ –æ–ø–ª–∞—á–µ–Ω</div>
                    <div class="status-item">4. –§–∏–Ω–∞–Ω—Å—ã –∑–∞–∫—Ä—ã—Ç—ã</div>
                    <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px; font-size: 12px;">
                        <strong>–ü—Ä–∞–≤–∏–ª–æ:</strong> –ì—Ä—É–∑ –Ω–µ –º–æ–∂–µ—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã (status >= 2)
                    </div>
                </div>

                <div class="status-column cargo">
                    <h4>üì¶ Cargo Status</h4>
                    <div class="status-item">0. –ù–µ –Ω–∞—á–∞—Ç</div>
                    <div class="status-item">1. –ü–æ—Å—Ç–∞–≤—â–∏–∫ –æ–ø–ª–∞—á–µ–Ω</div>
                    <div class="status-item">2. –ì—Ä—É–∑ –ø–æ–ª—É—á–µ–Ω (CN)</div>
                    <div class="status-item">3. –ü–µ—Ä–µ–¥–∞–Ω –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫—É</div>
                    <div class="status-item">4. –í –ø—É—Ç–∏</div>
                    <div class="status-item">5. –ù–∞ —Ç–∞–º–æ–∂–Ω–µ</div>
                    <div class="status-item">6. –¢–∞–º–æ–∂–Ω—è –ø—Ä–æ–π–¥–µ–Ω–∞</div>
                    <div class="status-item">7. –î–æ—Å—Ç–∞–≤–ª–µ–Ω</div>
                </div>

                <div class="status-column document">
                    <h4>üìÑ Document Status</h4>
                    <div class="status-item">0. –û–∂–∏–¥–∞–µ—Ç</div>
                    <div class="status-item">1. –ü–æ–¥–∞–Ω—ã</div>
                    <div class="status-item">2. –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</div>
                    <div class="status-item">3. –ö–æ—Ä–∏–¥–æ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω</div>
                    <div class="status-item">4. –í—ã–ø—É—â–µ–Ω</div>
                    <div class="status-item">5. –û—Ç–∫–ª–æ–Ω–µ–Ω</div>
                </div>
            </div>

            <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin-top: 30px; border-left: 4px solid #ffc107;">
                <h4 style="color: #856404; margin-bottom: 10px;">‚ö†Ô∏è –ü—Ä–∞–≤–∏–ª–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h4>
                <p style="font-size: 14px; color: #856404;">
                    –ú–µ—Ç–æ–¥ <code>can_proceed_cargo()</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ <code>financial_status >= PAYMENT_CONFIRMED</code> 
                    –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –≥—Ä—É–∑ –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –¥–æ –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏.
                </p>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 3: –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–¥–µ–ª–∫–∏ -->
        <div class="page">
            <h2 class="page-title">üìà –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–¥–µ–ª–∫–∏</h2>
            
            <div class="flow-container">
                <div class="flow-diagram">
                    <div class="flow-step">
                        <h4>1. –û–±—ä—è–≤–ª–µ–Ω–∏–µ</h4>
                        <p><strong>Announce</strong> —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º (–ì–æ—Å–ó–∞–∫—É–ø, –°–∞–º—Ä—É–∫)</p>
                        <p style="font-size: 12px; color: #888; margin-top: 10px;">–°–æ–¥–µ—Ä–∂–∏—Ç –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ <strong>AnnounceLot</strong></p>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-step">
                        <h4>2. –ò–Ω—Ç–µ—Ä–µ—Å</h4>
                        <p><strong>Interest</strong> - –∑–∞–∫–∞–∑—á–∏–∫ –ø—Ä–æ—è–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å –∫ –ª–æ—Ç—É</p>
                        <p style="font-size: 12px; color: #888; margin-top: 10px;">–°–≤—è–∑—ã–≤–∞–µ—Ç Customer –∏ AnnounceLot</p>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-step">
                        <h4>3. –ó–∞–∫–∞–∑</h4>
                        <p><strong>Order</strong> —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–∫–∞–∑—á–∏–∫–æ–º</p>
                        <p style="font-size: 12px; color: #888; margin-top: 10px;">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç <strong>Deal</strong> –≤ –º–µ—Ç–æ–¥–µ save()</p>
                    </div>
                </div>

                <div class="flow-diagram" style="margin-top: 30px;">
                    <div class="flow-step">
                        <h4>4. –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</h4>
                        <p><strong>Offer</strong> –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</p>
                        <p style="font-size: 12px; color: #888; margin-top: 10px;">–°–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å Deal —á–µ—Ä–µ–∑ offer_id</p>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-step">
                        <h4>5. –§–∏–Ω–∞–Ω—Å—ã</h4>
                        <p>Customer ‚Üí Operator KZ ‚Üí Operator CN</p>
                        <p style="font-size: 12px; color: #888; margin-top: 10px;">PENDING ‚Üí INITIATED ‚Üí CONFIRMED ‚Üí SUPPLIER_PAID</p>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-step">
                        <h4>6. –ì—Ä—É–∑</h4>
                        <p>Operator CN ‚Üí Carrier ‚Üí Customs</p>
                        <p style="font-size: 12px; color: #888; margin-top: 10px;">RECEIVED ‚Üí TRANSFERRED ‚Üí IN_TRANSIT ‚Üí DELIVERED</p>
                    </div>
                </div>

                <div class="flow-diagram" style="margin-top: 30px;">
                    <div class="flow-step">
                        <h4>7. –î–æ–∫—É–º–µ–Ω—Ç—ã</h4>
                        <p><strong>Customs</strong> –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã</p>
                        <p style="font-size: 12px; color: #888; margin-top: 10px;">PENDING ‚Üí SUBMITTED ‚Üí REVIEW ‚Üí CLEARED</p>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-step">
                        <h4>8. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ</h4>
                        <p>–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã</p>
                        <p style="font-size: 12px; color: #888; margin-top: 10px;">financial=COMPLETED<br>cargo=DELIVERED<br>document=CLEARED</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 4: –°–≤—è–∑–∏ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏ -->
        <div class="page">
            <h2 class="page-title">üîó –°–≤—è–∑–∏ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏</h2>
            
            <div class="diagram-container">
                <div style="text-align: center; margin-bottom: 40px;">
                    <div class="entity-box core">
                        <h3>Deal</h3>
                        <p>–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å</p>
                        <div class="fields">
                            announce_lot (FK)<br>
                            customer (FK)<br>
                            supplier (FK)<br>
                            offer_id (UUID)
                        </div>
                    </div>
                </div>

                <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 30px;">
                    <div style="text-align: center;">
                        <div class="entity-box">
                            <h4>AnnounceLot</h4>
                            <p>–õ–æ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è</p>
                            <div class="fields" style="margin-top: 10px;">
                                –û–¥–∏–Ω –ª–æ—Ç ‚Üí –æ–¥–Ω–∞ —Å–¥–µ–ª–∫–∞<br>
                                (unique constraint)
                            </div>
                        </div>
                        <div style="margin-top: 20px; font-size: 14px; color: #0095ff; font-weight: 600;">‚Üì</div>
                        <div class="entity-box" style="margin-top: 10px;">
                            <h4>Order</h4>
                            <p>–ó–∞–∫–∞–∑ –∑–∞–∫–∞–∑—á–∏–∫–∞</p>
                            <div class="fields" style="margin-top: 10px;">
                                –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏<br>
                                —Å–æ–∑–¥–∞—ë—Ç Deal
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <div class="entity-box">
                            <h4>Customer</h4>
                            <p>UserProfile</p>
                            <div class="fields" style="margin-top: 10px;">
                                –°–æ–∑–¥–∞—ë—Ç Order<br>
                                –ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –æ–ø–ª–∞—Ç—É
                            </div>
                        </div>
                        <div style="margin-top: 20px; font-size: 14px; color: #0095ff; font-weight: 600;">‚Üì</div>
                        <div class="entity-box" style="margin-top: 10px;">
                            <h4>Interest</h4>
                            <p>–ò–Ω—Ç–µ—Ä–µ—Å –∫ –ª–æ—Ç—É</p>
                            <div class="fields" style="margin-top: 10px;">
                                –ü—Ä–µ–¥—à–µ—Å—Ç–≤—É–µ—Ç Order
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <div class="entity-box">
                            <h4>Supplier</h4>
                            <p>UserProfile</p>
                            <div class="fields" style="margin-top: 10px;">
                                –°–æ–∑–¥–∞—ë—Ç Offer<br>
                                –ü–æ–ª—É—á–∞–µ—Ç –æ–ø–ª–∞—Ç—É
                            </div>
                        </div>
                        <div style="margin-top: 20px; font-size: 14px; color: #0095ff; font-weight: 600;">‚Üì</div>
                        <div class="entity-box" style="margin-top: 10px;">
                            <h4>Offer</h4>
                            <p>–ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</p>
                            <div class="fields" style="margin-top: 10px;">
                                –°–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å Deal<br>
                                —á–µ—Ä–µ–∑ offer_id
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 50px; padding: 30px; background: #fff; border-radius: 12px; border: 2px solid #0095ff;">
                    <h4 style="color: #0095ff; margin-bottom: 20px; text-align: center;">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div class="entity-box">
                            <h4>DealStatusHistory</h4>
                            <p>–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ</p>
                            <div class="fields" style="margin-top: 10px;">
                                status_type<br>
                                old_status ‚Üí new_status<br>
                                changed_by<br>
                                timestamp
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 5: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π -->
        <div class="page">
            <h2 class="page-title">üì¶ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</h2>
            
            <div class="app-interaction">
                <div class="app-card">
                    <h4>üéØ deals (CORE)</h4>
                    <ul>
                        <li>Deal - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å</li>
                        <li>DealStatusHistory</li>
                        <li>Enums: FinancialStatus, CargoStatus, DocumentStatus</li>
                        <li>Services: update_deal_status(), validate_deal_creation()</li>
                    </ul>
                    <div style="margin-top: 15px; padding: 10px; background: #e7f3ff; border-radius: 6px; font-size: 12px;">
                        <strong>API:</strong> /api/v1/deals/<br>
                        ReadOnly (—Å—Ç–∞—Ç—É—Å—ã –º–µ–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ä–æ–ª–µ–≤—ã–µ API)
                    </div>
                </div>

                <div class="app-card">
                    <h4>üë• customers</h4>
                    <ul>
                        <li>Interest - –∏–Ω—Ç–µ—Ä–µ—Å –∫ –ª–æ—Ç—É</li>
                        <li>Order - –∑–∞–∫–∞–∑ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç Deal)</li>
                        <li>OrderItem, OrderActivity, OrderAttachment</li>
                    </ul>
                    <div style="margin-top: 15px; padding: 10px; background: #f0fff4; border-radius: 6px; font-size: 12px;">
                        <strong>API:</strong> /api/v1/customers/<br>
                        –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Order ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è Deal
                    </div>
                </div>

                <div class="app-card">
                    <h4>üè≠ suppliers</h4>
                    <ul>
                        <li>Product - –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</li>
                        <li>Offer - –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</li>
                        <li>OfferActivity, OfferAttachment, OfferAnnounceLot</li>
                    </ul>
                    <div style="margin-top: 15px; padding: 10px; background: #fffbf0; border-radius: 6px; font-size: 12px;">
                        <strong>API:</strong> /api/v1/suppliers/<br>
                        Offer —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å Deal —á–µ—Ä–µ–∑ offer_id
                    </div>
                </div>

                <div class="app-card">
                    <h4>üá∞üáø operators_kz</h4>
                    <ul>
                        <li>PaymentConfirmation - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã</li>
                        <li>DealCompletion - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏</li>
                    </ul>
                    <div style="margin-top: 15px; padding: 10px; background: #f0fff4; border-radius: 6px; font-size: 12px;">
                        <strong>API:</strong> /api/v1/operators-kz/<br>
                        –ò–∑–º–µ–Ω—è–µ—Ç financial_status
                    </div>
                </div>

                <div class="app-card">
                    <h4>üá®üá≥ operators_cn</h4>
                    <ul>
                        <li>SupplierPayment - –æ–ø–ª–∞—Ç–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</li>
                        <li>CargoReceived - –ø–æ–ª—É—á–µ–Ω–∏–µ –≥—Ä—É–∑–∞</li>
                        <li>CargoTransferred - –ø–µ—Ä–µ–¥–∞—á–∞ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫—É</li>
                    </ul>
                    <div style="margin-top: 15px; padding: 10px; background: #fffbf0; border-radius: 6px; font-size: 12px;">
                        <strong>API:</strong> /api/v1/operators-cn/<br>
                        –ò–∑–º–µ–Ω—è–µ—Ç financial_status –∏ cargo_status
                    </div>
                </div>

                <div class="app-card">
                    <h4>üöö carriers</h4>
                    <ul>
                        <li>CargoTransport - —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≥—Ä—É–∑–∞</li>
                    </ul>
                    <div style="margin-top: 15px; padding: 10px; background: #fffbf0; border-radius: 6px; font-size: 12px;">
                        <strong>API:</strong> /api/v1/carriers/<br>
                        –û–±–Ω–æ–≤–ª—è–µ—Ç cargo_status (IN_TRANSIT)
                    </div>
                </div>

                <div class="app-card">
                    <h4>üõÉ customs</h4>
                    <ul>
                        <li>CustomsDeclaration - —Ç–∞–º–æ–∂–µ–Ω–Ω–∞—è –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è</li>
                    </ul>
                    <div style="margin-top: 15px; padding: 10px; background: #fff5f5; border-radius: 6px; font-size: 12px;">
                        <strong>API:</strong> /api/v1/customs/<br>
                        –ò–∑–º–µ–Ω—è–µ—Ç document_status –∏ cargo_status
                    </div>
                </div>

                <div class="app-card">
                    <h4>üîå integrations</h4>
                    <ul>
                        <li>–°–µ—Ä–≤–∏—Å—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API</li>
                        <li>Goszakup, Samruk –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</li>
                        <li>Celery –∑–∞–¥–∞—á–∏ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</li>
                    </ul>
                    <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 12px;">
                        <strong>API:</strong> /api/v1/integrations/<br>
                        –°–æ–∑–¥–∞—ë—Ç Announce –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º
                    </div>
                </div>
            </div>

            <div class="section-title">–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏:</div>
            <div style="background: #f9f9f9; padding: 30px; border-radius: 12px; margin-top: 20px;">
                <div style="display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 15px; font-size: 14px;">
                    <div style="background: #fff; padding: 15px; border-radius: 8px; border: 2px solid #0095ff;">
                        <strong>integrations</strong><br>
                        <span style="color: #888; font-size: 12px;">–°–æ–∑–¥–∞—ë—Ç Announce</span>
                    </div>
                    <div style="font-size: 24px; color: #0095ff;">‚Üí</div>
                    <div style="background: #fff; padding: 15px; border-radius: 8px; border: 2px solid #0095ff;">
                        <strong>customers</strong><br>
                        <span style="color: #888; font-size: 12px;">–°–æ–∑–¥–∞—ë—Ç Order ‚Üí Deal</span>
                    </div>
                    <div style="font-size: 24px; color: #0095ff;">‚Üí</div>
                    <div style="background: #fff; padding: 15px; border-radius: 8px; border: 2px solid #0095ff;">
                        <strong>suppliers</strong><br>
                        <span style="color: #888; font-size: 12px;">–°–æ–∑–¥–∞—ë—Ç Offer</span>
                    </div>
                    <div style="font-size: 24px; color: #0095ff;">‚Üí</div>
                    <div style="background: #fff; padding: 15px; border-radius: 8px; border: 2px solid #28a745;">
                        <strong>operators_kz</strong><br>
                        <span style="color: #888; font-size: 12px;">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—É</span>
                    </div>
                    <div style="font-size: 24px; color: #0095ff;">‚Üí</div>
                    <div style="background: #fff; padding: 15px; border-radius: 8px; border: 2px solid #ffc107;">
                        <strong>operators_cn</strong><br>
                        <span style="color: #888; font-size: 12px;">–û–ø–ª–∞—á–∏–≤–∞–µ—Ç, –ø–æ–ª—É—á–∞–µ—Ç –≥—Ä—É–∑</span>
                    </div>
                    <div style="font-size: 24px; color: #0095ff;">‚Üí</div>
                    <div style="background: #fff; padding: 15px; border-radius: 8px; border: 2px solid #ffc107;">
                        <strong>carriers</strong><br>
                        <span style="color: #888; font-size: 12px;">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç</span>
                    </div>
                    <div style="font-size: 24px; color: #0095ff;">‚Üí</div>
                    <div style="background: #fff; padding: 15px; border-radius: 8px; border: 2px solid #dc3545;">
                        <strong>customs</strong><br>
                        <span style="color: #888; font-size: 12px;">–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 6: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ Deal -->
        <div class="page">
            <h2 class="page-title">‚öôÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ Deal</h2>
            
            <div class="flow-container">
                <div class="flow-diagram">
                    <div class="flow-step">
                        <h4>1. –°–æ–∑–¥–∞–Ω–∏–µ Order</h4>
                        <p>–ó–∞–∫–∞–∑—á–∏–∫ —Å–æ–∑–¥–∞—ë—Ç <strong>Order</strong> —á–µ—Ä–µ–∑ API</p>
                        <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 12px; text-align: left;">
                            <strong>–î–∞–Ω–Ω—ã–µ:</strong><br>
                            ‚Ä¢ announce_lot (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)<br>
                            ‚Ä¢ customer (user_profile)<br>
                            ‚Ä¢ supplier<br>
                            ‚Ä¢ amount
                        </div>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-step">
                        <h4>2. –ú–µ—Ç–æ–¥ save()</h4>
                        <p>–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥ <code>Order.save()</code></p>
                        <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 12px; text-align: left;">
                            <strong>–ü—Ä–æ–≤–µ—Ä–∫–∞:</strong><br>
                            ‚Ä¢ is_new = self.pk is None<br>
                            ‚Ä¢ !self.deal (–µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω)<br>
                            ‚Ä¢ –í—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                        </div>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-step">
                        <h4>3. –í–∞–ª–∏–¥–∞—Ü–∏—è</h4>
                        <p>–í—ã–∑—ã–≤–∞–µ—Ç—Å—è <code>validate_deal_creation()</code></p>
                        <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 12px; text-align: left;">
                            <strong>–ü—Ä–æ–≤–µ—Ä–∫–∏:</strong><br>
                            ‚Ä¢ –ù–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π Deal –¥–ª—è –ª–æ—Ç–∞<br>
                            ‚Ä¢ Customer –∏ Supplier –≤–∞–ª–∏–¥–Ω—ã<br>
                            ‚Ä¢ –õ–æ—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                        </div>
                    </div>
                </div>

                <div class="flow-diagram" style="margin-top: 30px;">
                    <div class="flow-step">
                        <h4>4. –°–æ–∑–¥–∞–Ω–∏–µ Deal</h4>
                        <p><code>Deal.objects.create()</code></p>
                        <div style="margin-top: 15px; padding: 10px; background: #e7f3ff; border-radius: 6px; font-size: 12px; text-align: left;">
                            <strong>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:</strong><br>
                            ‚Ä¢ announce_lot<br>
                            ‚Ä¢ customer<br>
                            ‚Ä¢ supplier<br>
                            ‚Ä¢ offer_id<br>
                            ‚Ä¢ amount, currency<br>
                            ‚Ä¢ financial_status = PENDING
                        </div>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-step">
                        <h4>5. –°–≤—è–∑—ã–≤–∞–Ω–∏–µ</h4>
                        <p><code>order.deal = deal</code></p>
                        <div style="margin-top: 15px; padding: 10px; background: #f0fff4; border-radius: 6px; font-size: 12px; text-align: left;">
                            <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong><br>
                            ‚Ä¢ Order.deal = —Å–æ–∑–¥–∞–Ω–Ω–∞—è Deal<br>
                            ‚Ä¢ OneToOne —Å–≤—è–∑—å<br>
                            ‚Ä¢ Order.save(update_fields=['deal'])
                        </div>
                    </div>
                </div>
            </div>

            <div style="background: #fff3cd; padding: 25px; border-radius: 12px; margin-top: 40px; border-left: 4px solid #ffc107;">
                <h4 style="color: #856404; margin-bottom: 15px;">üìù –ö–æ–¥ –∏–∑ models.py:</h4>
                <pre style="background: #f8f9fa; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 13px; color: #333;"><code>def save(self, *args, **kwargs):
    is_new = self.pk is None
    super().save(*args, **kwargs)
    
    if is_new and not self.deal and self.announce_lot and self.user_profile and self.supplier:
        validate_deal_creation(
            announce_lot=self.announce_lot,
            customer=self.user_profile,
            supplier=self.supplier
        )
        
        self.deal = Deal.objects.create(
            announce_lot=self.announce_lot,
            customer=self.user_profile,
            supplier=self.supplier,
            offer_id=self.offer_id,
            amount=self.amount,
            currency='KZT',
            financial_status=FinancialStatus.PENDING,
        )
        self.save(update_fields=['deal'])</code></pre>
            </div>
        </div>

        <!-- –õ–µ–≥–µ–Ω–¥–∞ -->
        <div class="legend">
            <h3 style="color: #0095ff; margin-bottom: 20px;">üìã –õ–µ–≥–µ–Ω–¥–∞</h3>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-color" style="background: #0095ff;"></div>
                    <span>–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å (Deal)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #28a745;"></div>
                    <span>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ffc107;"></div>
                    <span>–°—Ç–∞—Ç—É—Å –≥—Ä—É–∑–∞</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #dc3545;"></div>
                    <span>–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #6c757d; border-color: #6c757d;"></div>
                    <span>Legacy –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</span>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
